# =========================
# TRACER AI ‚Äî –ê–ù–ê–õ–ò–ó –ö–û–î–ê
# =========================

import ast
import traceback
from textwrap import indent

# -------------------------
# –ü–û–®–ê–ì–û–í–ê–Ø –¢–†–ê–°–°–ò–†–û–í–ö–ê
# -------------------------

def trace_code(code):
    print("\nüîé –ü–æ—à–∞–≥–æ–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:\n")
    env = {}
    lines = code.splitlines()

    for i, line in enumerate(lines, 1):
        if not line.strip():
            continue
        print(f"‚ñ∂ –°—Ç—Ä–æ–∫–∞ {i}: {line}")
        try:
            exec(line, env)
            vars_view = {k: v for k, v in env.items() if not k.startswith("__")}
            print("   –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:", vars_view)
        except Exception as e:
            print("   ‚ùå –û—à–∏–±–∫–∞:", e)
            break
    print("\n‚úî –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")

# -------------------------
# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ö–û–î–ê
# -------------------------

COMMON_FIXES = [
    ("print 3", "print(3)"),
    ("if a > b print(a)", "if a > b:\n    print(a)"),
    ("for i in range 5", "for i in range(5):"),
]

def fix_code(code):
    fixed = code
    for bad, good in COMMON_FIXES:
        if bad in fixed:
            fixed = fixed.replace(bad, good)
    return fixed

def fix_dialog():
    print("\nüß© –í—Å—Ç–∞–≤—å —Å–≤–æ–π –∫–æ–¥ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:")
    user_code = []
    while True:
        line = input()
        if line.strip().lower() == "–∫–æ–Ω–µ—Ü":
            break
        user_code.append(line)

    code = "\n".join(user_code)
    fixed = fix_code(code)

    if fixed != code:
        print("\n‚úÖ –í–æ–∑–º–æ–∂–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:\n")
        print(fixed)
    else:
        print("\nü§î –Ø –Ω–µ –Ω–∞—à—ë–ª —Ç–∏–ø–æ–≤—ã—Ö –æ—à–∏–±–æ–∫, –Ω–æ –≤–æ—Ç —á—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Python:\n")
        try:
            compile(code, "<user>", "exec")
            print("–°–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—ã–≥–ª—è–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.")
        except Exception:
            print(traceback.format_exc())

# -------------------------
# –ù–ï–°–ö–û–õ–¨–ö–û –í–ê–†–ò–ê–ù–¢–û–í –†–ï–®–ï–ù–ò–Ø
# -------------------------

def multiple_solutions(task_key):
    if task_key == "max_ab":
        return [
            (
                "–í–∞—Ä–∏–∞–Ω—Ç 1 (if/else)",
                "a = int(input())\nb = int(input())\nprint(a if a>b else b if b>a else '=')"
            ),
            (
                "–í–∞—Ä–∏–∞–Ω—Ç 2 (max)",
                "a = int(input())\nb = int(input())\nprint(max(a,b))"
            )
        ]
    return []

def show_multiple(task_key):
    sols = multiple_solutions(task_key)
    if not sols:
        print("‚ùå –ù–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏.")
        return
    for title, code in sols:
        print(f"\nüîπ {title}\n{code}")

# -------------------------
# –†–ï–ñ–ò–ú –û–ë–£–ß–ï–ù–ò–Ø
# -------------------------

LESSONS = {
    "for": {
        "question": "–ö–∞–∫ –≤—ã–≤–µ—Å—Ç–∏ —á–∏—Å–ª–∞ –æ—Ç 0 –¥–æ 4?",
        "hint": "–ò—Å–ø–æ–ª—å–∑—É–π range(5)",
        "answer": "for i in range(5):\n    print(i)"
    },
    "if": {
        "question": "–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ a –±–æ–ª—å—à–µ b?",
        "hint": "–ù—É–∂–µ–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä >",
        "answer": "if a > b:\n    print(a)"
    }
}

def learning_mode(topic):
    lesson = LESSONS.get(topic)
    if not lesson:
        print("‚ùå –ü–æ–∫–∞ –Ω–µ—Ç —É—Ä–æ–∫–∞ –ø–æ —ç—Ç–æ–π —Ç–µ–º–µ.")
        return

    print("\nüéì –í–û–ü–†–û–°:")
    print(lesson["question"])
    input("\n–ù–∞–∂–º–∏ Enter –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏...")
    print("üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:", lesson["hint"])
    input("\n–ù–∞–∂–º–∏ Enter –¥–ª—è –æ—Ç–≤–µ—Ç–∞...")
    print("‚úÖ –û—Ç–≤–µ—Ç:\n")
    print(lesson["answer"])

# -------------------------
# –ú–ï–ù–Æ –ú–û–î–£–õ–Ø
# -------------------------

def tracer_menu():
    print("""
üß† –ê–ù–ê–õ–ò–ó –ö–û–î–ê ‚Äî –í–û–ó–ú–û–ñ–ù–û–°–¢–ò
- —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞
- –∏—Å–ø—Ä–∞–≤—å –∫–æ–¥
- –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ—à–µ–Ω–∏–π
- –æ–±—É—á–µ–Ω–∏–µ
- –≤—ã—Ö–æ–¥
""")

    while True:
        cmd = input("\n>> ").lower()

        if cmd == "–≤—ã—Ö–æ–¥":
            break

        if "—Ç—Ä–∞—Å—Å" in cmd:
            print("–í—Å—Ç–∞–≤—å –∫–æ–¥, –∑–∞—Ç–µ–º –Ω–∞–ø–∏—à–∏ '–∫–æ–Ω–µ—Ü':")
            code = []
            while True:
                l = input()
                if l.strip().lower() == "–∫–æ–Ω–µ—Ü":
                    break
                code.append(l)
            trace_code("\n".join(code))
            continue

        if "–∏—Å–ø—Ä–∞–≤" in cmd:
            fix_dialog()
            continue

        if "–Ω–µ—Å–∫–æ–ª—å–∫–æ" in cmd:
            show_multiple("max_ab")
            continue

        if "–æ–±—É—á" in cmd:
            topic = input("–¢–µ–º–∞ (for/if): ")
            learning_mode(topic)
            continue

        print("ü§î –ö–æ–º–∞–Ω–¥–∞ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞.")
